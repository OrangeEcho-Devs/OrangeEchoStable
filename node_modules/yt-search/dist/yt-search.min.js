!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ytSearch=t()}}(function(){return function i(o,l,s){function u(e,t){if(!l[e]){if(!o[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(c)return c(e,!0);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}var n=l[e]={exports:{}};o[e][0].call(n.exports,function(t){return u(o[e][1][t]||t)},n,n.exports,i,o,l,s)}return l[e].exports}for(var c="function"==typeof require&&require,t=0;t<s.length;t++)u(s[t]);return u}({1:[function(u,t,e){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var c=u("cheerio"),p=u("dasu");u("async.parallellimit");p.follow=!1,p.debug=!1;var m=u("jsonpath"),d="Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html) (yt-search; https://www.npmjs.com/package/yt-search)",f=u("url"),r={};Object.keys(process.env).forEach(function(t){var e=process.env[t];if("0"==e||"false"==e||!e)return r[t]=!1;r[t]=e});var h=r.debug;function b(){h&&console.log.apply(this,arguments)}var a,T=u("querystring"),g=u("human-time"),x={YT:"https://youtube.com",SEARCH_MOBILE:"https://m.youtube.com/results",SEARCH_DESKTOP:"https://www.youtube.com/results"};function n(t,e){if(!e)return new Promise(function(r,a){n(t,function(t,e){if(t)return a(t);r(e)})});var r=void 0;if((r="string"==typeof t?{query:t}:t).userAgent&&(d=r.userAgent),r.search=r.query||r.search,r.original_search=r.search,r.videoId)return function(t,n){b("fn: getVideoMetaData");var e=void 0;"string"==typeof t&&(e=t);"object"===(void 0===t?"undefined":i(t))&&(e=t.videoId);var r="https://www.youtube.com/watch?hl=en&gl=US&v="+e,a=f.parse(r);a.headers={"user-agent":d,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},a.headers["user-agent"]="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Safari/605.1.15",p.req(a,function(t,e,r){if(t)n(t);else{if(200!==e.status)return n("http status: "+e.status);if(h){var a=u("fs");u("path");a.writeFileSync("dasu.response",e.responseText,"utf8")}try{!function(t,e){b("_parseVideoInitialData");var r=t.match(/ytInitialData.*=\s*({.*});/);if(!r[1])return e("could not find inital data in the html document");var a=t.match(/ytInitialPlayerResponse.*=\s*({.*});/);if(!a[1])return e("could not find inital player data in the html document");var n=JSON.parse(r[1]),i=JSON.parse(a[1]),o=m.value(n,"$..currentVideoEndpoint..videoId");if(!o)return e("video unavailable");if("ERROR"===m.value(i,"$..status")||"Video unavailable"===m.value(i,"$..reason"))return e("video unavailable");var l=m.value(n,"$..videoPrimaryInfoRenderer..title..text")||m.value(n,"$..videoPrimaryInfoRenderer..title..simpleText")||m.value(n,"$..videoPrimaryRenderer..title..text")||m.value(n,"$..videoPrimaryRenderer..title..simpleText")||m.value(n,"$..title..text")||m.value(n,"$..title..simpleText"),s=m.value(i,"$..description..text")||m.value(i,"$..description..simpleText")||m.value(n,"$..description..text")||m.value(n,"$..description..simpleText"),u=m.value(n,"$..owner..title..text")||m.value(n,"$..owner..title..simpleText"),c=m.value(n,"$..owner..navigationEndpoint..url")||m.value(n,"$..owner..title..url"),p="https://i.ytimg.com/vi/"+o+"/hqdefault.jpg",d=$(_(1e3*Number(m.value(i,"$..videoDetails..lengthSeconds")))),f=m.value(n,"$..sentimentBar..tooltip").split(/[,.]/).join("").split(/\D+/),h=(Number(f[0]),Number(f[1]),m.value(n,"$..dateText")),v={title:l,description:s,url:x.YT+"/watch?v="+o,videoId:o,seconds:Number(d.seconds),timestamp:d.timestamp,duration:d,views:Number(m.value(i,"$..videoDetails..viewCount")),genre:(m.value(i,"$..category")||"").toLowerCase(),uploadDate:m.value(i,"$..uploadDate"),ago:g(new Date(h)),image:p,thumbnail:p,author:{name:u,url:x.YT+c}};e(null,v)}(r,n)}catch(t){n(t)}}})}(r.videoId,e);if(r.listId)return function(t,n){b("fn: getPlaylistMetaData");var e=void 0;"string"==typeof t&&(e=t);"object"===(void 0===t?"undefined":i(t))&&(e=t.listId||t.playlistId);var r="https://www.youtube.com/playlist?hl=en&gl=US&list="+e,a=f.parse(r);a.headers={"user-agent":d,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},p.req(a,function(t,e,r){if(t)n(t);else{if(200!==e.status)return n("http status: "+e.status);if(h){var a=u("fs");u("path");a.writeFileSync("dasu.response",e.responseText,"utf8")}try{!function(t,e){b("fn: parsePlaylistBody"),console.log("parsePlaylistInitialData");var r=t.match(/ytInitialData.*=\s*({.*});/)[1];if(!r)throw new Error("failed to parse ytInitialData json data");var a=JSON.parse(r),n=m.value(a,"$..microformat..urlCanonical").split("=")[1];console.log("listId: "+n);var i=m.value(a,"$..sidebar.playlistSidebarRenderer.items[0]..stats[1].simpleText").match(/\d+/);console.log("viewCount: "+i);var o=m.query(a,"$..contents..tabs[0]..contents[0]..contents[0]..contents")[0],l=[];o.forEach(function(t){var e=t,r={title:m.value(e,"$..title..simpleText"),videoId:m.value(e,"$..videoId"),listId:n,thumbnail:m.value(e,"$..thumbnail..thumbnails[0]..url").split("?")[0],author:{name:m.value(e,"$..shortBylineText..runs[0]..text"),url:"https://youtube.com"+m.value(e,"$..shortBylineText..runs[0]..url")}};l.push(r)}),console.log(l),console.log("videos.length: "+l.length);var s={title:m.value(a,"$..microformat..title"),listId:n,url:"https://youtube.com/playlist?list="+n,views:Number(i),date:D(m.value(a,"$..sidebar.playlistSidebarRenderer.items[0]..stats[2]..simpleText")),image:l[0].thumbnail,thumbnail:l[0].thumbnail,videos:l,author:{name:m.value(a,"$..videoOwner..title..runs[0]..text"),url:"https://youtube.com"+m.value(a,"$..videoOwner..navigationEndpoint..url")}};e&&e(null,s)}(r,n)}catch(t){n(t)}}})}(r.listId,e);if(!r.search)return e(Error("yt-search: no query given"));!function m(g,y){var t=T.escape(g.search).split(/\s+/),e=g.hl||"en",r=g.gl||"US",a=g.category||"",n=Number(g.pageStart)||1,i=Number(g.pageEnd)||Number(g.pages)||1;n<=0&&(n=1)<=i&&(i+=1),Number.isNaN(i)&&y("error: pageEnd must be a number"),g.pageStart=n,g.pageEnd=i,g.currentPage=g.currentPage||n;var o="?";-1===(o+="search_query="+t.join("+")).indexOf("&hl=")&&(o+="&hl="+e),-1===o.indexOf("&gl=")&&(o+="&gl="+r),a&&(o+="&category="+a),g.sp&&(o+="&sp="+g.sp);var l=x.SEARCH_DESKTOP+o,s=f.parse(l);s.headers={"user-agent":d,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},b(s),b("getting results: "+g.currentPage),p.req(s,function(t,e,r){if(t)y(t);else{if(200!==e.status)return y("http status: "+e.status);if(h){var a=u("fs");u("path"),a.writeFileSync("dasu.response",e.responseText,"utf8")}try{v(r,function(t,e){if(t)return y(t);var r=e,a=r.filter(w),n=r.filter(I),i=r.filter(S);g._data=g._data||{},g._data.videos=g._data.videos||[],g._data.playlists=g._data.playlists||[],g._data.channels=g._data.channels||[],a.forEach(function(t){g._data.videos.push(t)}),n.forEach(function(t){g._data.playlists.push(t)}),i.forEach(function(t){g._data.channels.push(t)}),g.currentPage++;var o=g.currentPage<=g.pageEnd;if(o&&e._sp)g.sp=e._sp,setTimeout(function(){m(g,y)},1500);else{for(var l=g._data.videos.filter(w),s=g._data.playlists.filter(I),u=g._data.channels.filter(S),c=[],p=[],d=0;d<l.length;d++){var f=l[d];f.views<5?p.push(f):c.push(f)}for(var h=0;h<p.length;h++){var v=p[h];c.push(v)}y(null,{videos:c,playlists:s,lists:s,accounts:u,channels:u})}})}catch(t){y(t)}}})}(r,e)}function w(t,e,r){if("video"!==t.type)return!1;var a=t.videoId;return r.findIndex(function(t){return a===t.videoId})===e}function I(t,e,r){if("list"!==t.type)return!1;var a=t.listId;return r.findIndex(function(t){return a===t.listId})===e}function S(t,e,r){if("channel"!==t.type)return!1;var a=t.url;return r.findIndex(function(t){return a===t.url})===e}function v(t,e){var r=c.load(t),a=r("li .yt-lockup-tile"),n=[],i=[];try{var o=r("div.search-pager > button ~")[0];n._sp=o.attribs.href.split("&sp=")[1]}catch(t){b("next page results link not found")}for(var l=0;l<a.length;l++){var s=r(a[l]);try{var u=y(r,s);u&&n.push(u)}catch(t){i.push(t)}}e(i[0]||void 0,n)}function y(t,e){var r=t("a",e).attr("href")||"",a=T.parse(r.split("?",2)[1]);return a.list?function(t,e){var r=t(".yt-lockup-content",e),a=t(".yt-lockup-title",r),n=t("a",a),i=n.text().trim(),o=n.attr("href"),l=T.parse(o.split("?",2)[1]),s=l.list,u=l.v,c="",p="",d="",f="",h="",v="",m=t(".yt-lockup-byline",r),g=t("a",m),y=g.attr("href")||"";if(y)0<=y.indexOf("channel/")&&(c=y.split("/").pop(),p="https://youtube.com/channel/"+c,d=g.text().trim()),0<=y.indexOf("user/")&&(f=y.split("/").pop(),h="https://youtube.com/user/"+f,v=g.text().trim());else{var b=m.text().trim();v=b}var x=t(".sidebar",e).text().trim(),w=Number(x.replace(/\D+/g,"")),I=t("li.yt-lockup-playlist-item",r),S=t("a",I[0]).attr("href"),$=T.parse(S.split("?",2)[1]).v,_=u||$,D="https://i.ytimg.com/vi/"+_+"/hqdefault.jpg";return{type:"list",title:i,url:"https://youtube.com/playlist?list="+s,listId:s,videoCountLabel:x,videoCount:w,image:D,thumbnail:D,author:{name:v||d,id:f||c,url:h||p,userId:f,userUrl:h,userName:v,channelId:c,channelUrl:p,channelName:d}}}(t,e):0===r.indexOf("/channel/")||0===r.indexOf("/user/")?function(t,e){var r="https:"+t("img",e).attr("src"),a=t(".yt-lockup-content",e),n=t(".yt-lockup-title",a),i=t("a",n),o=(i.text().trim(),i.attr("href")||""),l="",s="",u="",c="",p="",d="";0<=o.indexOf("channel/")&&(l=o.split("/").pop(),s="https://youtube.com/channel/"+l,u=i.text().trim());0<=o.indexOf("user/")&&(c=o.split("/").pop(),p="https://youtube.com/user/"+c,d=i.text().trim());var f=t(".yt-lockup-meta-info",a).text().trim(),h=Number(f.replace(/\D+/g,"")),v=t(".yt-lockup-description",a).text().trim();return m={type:"channel",title:d||u,description:v,url:p||s,videoCountLabel:f,videoCount:h,image:r,thumbnail:r,name:d||u,id:c||l},g="url",y=p||s,g in m?Object.defineProperty(m,g,{value:y,enumerable:!0,configurable:!0,writable:!0}):m[g]=y,m;var m,g,y}(t,e):a.v?function(t,e){var r=t(".yt-lockup-content",e),a=t(".yt-lockup-title",r),n=(t("img",e).src,t("a",a)),i=$(t("span",a).text()),o=n.attr("href")||"",l=T.parse(o.split("?",2)[1]).v,s=t(".yt-lockup-description",r).text().trim(),u=t(".yt-lockup-meta-info",r),c=t("li",u),p=t(c[0]).text(),d=t(c[1]).text(),f=Number(d.split(" ")[0].split(",").join("").trim()),h="",v="",m="",g="",y=t('a[href^="/user/"]',r);y&&(m=(y.attr("href")||"").replace("/user/","").trim(),g=y.text().trim());var b=t('a[href^="/channel/"]',r);b&&(h=(b.attr("href")||"").replace("/channel/","").trim(),v=b.text().trim());h&&"https://youtube.com/channel/"+h;m&&"https://youtube.com/user/"+m;var x="https://i.ytimg.com/vi/"+l+"/hqdefault.jpg";return{type:"video",title:n.text().trim(),description:s,url:"https://youtube.com/watch?v="+l,videoId:l,seconds:Number(i.seconds),timestamp:i.timestamp,duration:i,views:Number(f),image:x,thumbnail:x,ago:p,author:{name:g||v,url:y.attr("href")||b.attr("href")}}}(t,e):void 0}function $(t){var e=t.split(/\s+/),r=e[e.length-1].replace(/[^:.\d]/g,"");if(!r)return{toString:function(){return e[0]},seconds:0,timestamp:0};for(;r[r.length-1].match(/\D/);)r=r.slice(0,-1);for(var a=(r=r.replace(/\./g,":")).split(/[:.]/),n=0,i=0,o=a.length-1;0<=o;o--)if(!(a[o].length<=0)){var l=a[o].replace(/\D/g,"");if(n+=parseInt(l)*(0<i?Math.pow(60,i):1),2<++i)break}return{toString:function(){return n+" seconds ("+r+")"},seconds:n,timestamp:r}}function _(t){var e="",r=Math.floor(t/36e5),a=Math.floor(t/6e4)%60,n=Math.floor(t/1e3)%60;return r&&(e+=r+":"),a&&(e+=a+":"),String(n).length<2&&(e+="0"),e+=n}function D(t){b("fn: _parsePlaylistLastUpdateTime");for(var e=t.trim().split(/[\s.-]+/),r=0;r<e.length;r++){var a=e.slice(r),n=a.join(" "),i=a.reverse().join(" "),o=new Date(n),l=new Date(i);if("Invalid Date"!==o.toString())return s(o);if("Invalid Date"!==l.toString())return s(l)}return""}function s(t){return b("fn: _toInternalDateString"),t.getUTCFullYear()+"-"+t.getUTCMonth()+"-"+t.getUTCDate()}t.exports=function(t,e){return n(t,e)},t.exports.search=n,u.main===t&&(a="superman theme list pewdiepie channel",console.log("test: doing list search"),n({query:a,pageEnd:1},function(t,e){if(t)throw t;var r=e.videos,a=e.playlists,n=e.channels;console.log("videos: "+r.length),console.log("playlists: "+a.length),console.log("channels: "+n.length);for(var i=0;i<r.length;i++){var o=r[i],l=" ("+o.timestamp+")";console.log(o.title+l)}a.forEach(function(t){console.log("playlist: "+t.title+" | "+t.listId)}),n.forEach(function(t){console.log("channel: "+t.title+" | "+t.description)})}))},{"async.parallellimit":void 0,cheerio:void 0,dasu:void 0,fs:void 0,"human-time":void 0,jsonpath:void 0,path:void 0,querystring:void 0,url:void 0}]},{},[1])(1)});